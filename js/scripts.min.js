$(function() {
	$('.i-popup').magnificPopup();

	$(".not-adaptive").on('click', function(event) {
		event.preventDefault();
		
		$("body").removeClass("adaptive");
	});

	var swiper = new Swiper('.swiper-container', {
		slidesPerView: 'auto', 
		spaceBetween: 0,
		freeMode: true, 
		autoplay: 10,
		speed: 10000,
		loop: true,
		autoplayDisableOnInteraction: false
	});

	var a = null;
	var audio;
	var tracks = Array();
	var active_track = 0;
	$(".play-audio").each(function(index, el) {
		tracks.push($(el).attr("href"));
	});
	$(".play-audio").on('click', function(event) {
		event.preventDefault();

		active_track = $.inArray($(this).attr("href"), tracks);

		if (a == null) {
			create_player();
		}

		audio.load(tracks[active_track]);
		audio.play();
	});

	function create_player() {
		a = audiojs.createAll({
			trackEnded: function() {
				active_track++;
				if (active_track == tracks.length - 1) {
					active_track = 0;
				}
				audio.load(tracks[active_track]);
				audio.play();
			}
		});

		audio = a[0];

		$(".audio").addClass("audio-active");
		$("body").addClass("player_visible");

		$("body").on('click', ".prev-song", function(event) {
			event.preventDefault();
			active_track++;
			if (active_track == tracks.length - 1) {
				active_track = 0;
			}
			audio.load(tracks[active_track]);
			audio.play();
		});

		$("body").on('click', ".next-song", function(event) {
			event.preventDefault();
			active_track--;
			if (active_track == -1) {
				active_track = tracks.length - 1;
			}
			audio.load(tracks[active_track]);
			audio.play();
		});

		$(document).keydown(function(e) {
			var unicode = e.charCode ? e.charCode : e.keyCode;
			
			if (unicode == 32) {
				e.preventDefault();
			   audio.playPause();
			}
		});
	}

	$("#menu_select").on('change', function(event) {
		event.preventDefault();
		
		var target = $(this);

		window.location = target.val();
	});
});